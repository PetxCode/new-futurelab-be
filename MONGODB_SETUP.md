# MongoDB Atlas Setup for Vercel Deployment

## Prerequisites

- MongoDB Atlas account (free: https://www.mongodb.com/cloud/atlas)
- Vercel account
- Credit card for Atlas (free tier requires verification)

## Step 1: Create MongoDB Atlas Account

1. Go to https://www.mongodb.com/cloud/atlas
2. Click "Try Free" or sign up
3. Complete email verification
4. Create new organization/project

## Step 2: Create a Cluster

1. Click "Create Deployment"
2. Select **Free M0 cluster** (free tier)
3. Choose cloud provider (AWS, Azure, or Google Cloud)
4. Choose region closest to your users
5. Name your cluster (e.g., "themake-prod")
6. Click "Create Deployment"
7. Wait 2-5 minutes for cluster to initialize

## Step 3: Create Database User

1. Go to **Security** → **Database Access** → **Add New User**
2. **Username:** Create a strong username (e.g., `themake_admin`)
3. **Password:** Generate strong password or use autogenerated
   - ⚠️ **Save this password securely** (can't retrieve later)
   - Use password manager to store
4. **User Privileges:** Select "Readwrite to any database"
5. Click "Add User"

## Step 4: Setup Network Access

1. Go to **Security** → **Network Access** → **Add IP Address**
2. For Vercel: Click **"Allow Access from Anywhere"** (0.0.0.0/0)
   - ⚠️ Less secure but necessary for serverless
   - Alternative: Add specific Vercel IP ranges (if available)
3. Click "Confirm"

## Step 5: Get Connection String

1. Go to **Deployment** → **Database** → Click **"Connect"**
2. Choose **"Drivers"** method
3. Select **Node.js** driver
4. Copy the connection string
   - Format: `mongodb+srv://username:password@cluster.mongodb.net/myFirstDatabase?retryWrites=true&w=majority`

## Step 6: Update Connection String

Replace placeholders:

- `username` → Your database user (created in Step 3)
- `password` → Your database password (created in Step 3)
- `cluster` → Your cluster name
- `/myFirstDatabase` → `/themake` (or your database name)

**Final format:**

```
mongodb+srv://themake_admin:YourPasswordHere@themake-cluster.g4w5h.mongodb.net/themake?retryWrites=true&w=majority
```

## Step 7: Add to Vercel

1. Go to Vercel Dashboard → Your Project → Settings
2. Go to **Environment Variables**
3. Add variable:
   - **Name:** `MONGODB_URI`
   - **Value:** Paste your connection string from Step 6
4. Click "Save"
5. Redeploy backend (Vercel will auto-redeploy on settings change)

## Verification

Test connection with curl:

```bash
curl https://your-app.vercel.app/api/health
```

Check backend logs in Vercel:

- Should see "MongoDB connected" message

## MongoDB Atlas Free Tier Limits

- **Storage:** 512 MB
- **Connections:** 100 concurrent
- **Data Transfer:** Shared clusters (suitable for learning/testing)
- **Backups:** 7-day retention

⚠️ **Monitor usage** - if you exceed limits, upgrade plan

## Troubleshooting

### "Connection refused"

→ Check IP whitelist includes 0.0.0.0/0 or Vercel IPs

### "Authentication failed"

→ Verify username/password are correct in connection string

### "Database does not exist"

→ MongoDB creates database automatically on first write (normal)

### "Timeout after 30 seconds"

→ Network issue. Check:

1. Vercel logs for error details
2. IP whitelist includes Vercel
3. Connection string is correct

## Backup & Recovery

MongoDB Atlas free tier:

- Automatic backups: **7 days retention**
- Can restore from snapshots in Atlas console
- Choose **Backup and Recovery** in cluster settings

## Monitoring

1. **Metrics:** Click your cluster → **Metrics** tab

   - CPU usage
   - Storage usage
   - Network I/O
   - Connections

2. **Alerts:** Setup alerts for quota warnings
   - Go to **Settings** → **Alerts**
   - Recommended: Alert when storage > 80%

## Next Steps

After MongoDB Atlas is connected:

1. ✅ Backend will connect automatically
2. ✅ All API endpoints will work
3. ✅ Data persists between deployments
4. ✅ Ready to use in production

---

**Database Setup Status:** ✅ Ready
**Connection String:** Secure in Vercel environment variables
**Backups:** Automatic daily (free tier: 7-day retention)
